#!/usr/bin/env node
var z=class{chamber;previewChamber;level=1;score=0;totalFilledRows=0;gravitySpeed;isPaused=!1;isActive=!0;constructor(e,t,r){this.chamber=e,this.previewChamber=t,this.gravitySpeed=r}reset(e,t,r){this.chamber=e,this.previewChamber=t,this.level=1,this.score=0,this.totalFilledRows=0,this.gravitySpeed=r,this.isPaused=!1,this.isActive=!0}};var Ge=["\u2191","\u2190","\u2193","\u2192"],Oe=["\u27F3","L","D","R","I","F","U","T","Y","s","p","a","c","e",":","u","Q","q","i","t",'"',"y","E","N","O","M","H","A"],X=["N","E","X","T"],j=["L","E","V","E","L"],K=["S","C","O","R","E"],le=["D","I","F","F","I","C","U","L","T","Y"];var mt=[["O","."],["O","."],["O","O"]],Fe=mt;var ht=[[".",".","."],["O","O","O"],[".","O","."]],He=ht;var dt=[[".","O"],[".","O"],["O","O"]],_e=dt;var ft=[["O"],["O"],["O"],["O"]],Ne=ft;var yt=[["O","O"],["O","O"]],Ue=yt;var gt=[["O","O","."],[".","O","O"]],ke=gt;var vt=[[".","O","O"],["O","O","."]],Ve=vt;var bt=o=>o.map(e=>[...e]),Be=o=>new Map(JSON.parse(JSON.stringify([...o]))),I=bt;var Lt=(o,e)=>I(o).map(t=>{let r=t.length,i=e-r-2,n=Math.floor(i/2),a=i-n;return["|",...Array(n).fill("."),...t,...Array(a).fill("."),"|"]}),E=new Map,ce=()=>(E.size===0&&(E.set(0,He),E.set(1,Fe),E.set(2,_e),E.set(3,Ne),E.set(4,Ue),E.set(5,ke),E.set(6,Ve)),Be(E)),wt=()=>{let o=ce();for(let[e,t]of o.entries())o.set(e,Lt(t,17));return o},$e=wt;var R=class{static emptyPreviewArea(e){for(let t=0;t<e.length;t++)for(let r=0;r<e[0].length;r++)e[t][r]=" "}static addPreviewNextShape(e,t,r,i=0,n){let a=Array.from({length:t[0].length}).map(()=>" "),l=I(ce().get(e));this.emptyPreviewArea(t);let m=[];for(let u=0;u<t[0].length;u++)u<X.length?m.push(X[u]):m.push(" ");l.unshift(m);let L=4,T=l.length-1,O=L-T;for(let u=0;u<O;u++)l.push(a);let P=[];for(let u=0;u<t[0].length;u++)u<j.length?P.push(j[u]):P.push(" ");l.push(j);let D=[r.toString()];l.push(D),l.push(a);let A=[];for(let u=0;u<t[0].length;u++)u<K.length?A.push(K[u]):A.push(" ");l.push(A);let Re=i.toString().split("");if(l.push(Re),l.push(a),n){let u=[];for(let v=0;v<t[0].length;v++)v<le.length?u.push(le[v]):u.push(" ");l.push(u);let H=n.getName().split("");l.push(H),l.push(a)}let y=Array.from({length:t[0].length}).map(()=>" ");y[2]="\u27F3",l.push(y);let f=Array.from({length:t[0].length}).map(()=>" ");f[2]="\u2191",l.push(f);let C=Array.from({length:t[0].length}).map(()=>" ");C[0]="\u2190",C[2]="\u2193",C[4]="\u2192",l.push(C);let F=Array.from({length:t[0].length}).map(()=>" ");F[0]="L",F[2]="D",F[4]="R",l.push(F),l.push(a);let Te=Array.from({length:t[0].length}).map(()=>" "),Pe='" ":pause';for(let u=0;u<Pe.length&&u<t[0].length;u++)Te[u]=Pe[u];l.push(Te);let De=Array.from({length:t[0].length}).map(()=>" "),Ae="Q:quit";for(let u=0;u<Ae.length&&u<t[0].length;u++)De[u]=Ae[u];l.push(De);for(let u=0;u<l.length;u++)for(let H=0;H<l[u].length;H++){let v=l[u][H];typeof v<"u"&&(t[u][H]=v==="O"||X.includes(v)||j.includes(v)||K.includes(v)||Ge.includes(v)||Oe.includes(v)||Number.isSafeInteger(parseInt(v))?v:" ")}return t}static initializeChamber(){return Array.from({length:25}).map(()=>Array.from({length:10}).map(()=>" "))}};var Z=class{gameState;gameLogic;renderer;inputHandler;difficulty;gameMode;constructor(e,t,r,i){this.gameLogic=e,this.renderer=t,this.inputHandler=r,this.difficulty=i;let n=this.createChamber(),a=this.createPreviewChamber();this.gameState=new z(n,a,this.difficulty.getInitialGravitySpeed())}createChamber(){return this.gameLogic.initializeChamber()}createPreviewChamber(){return R.initializeChamber()}setGameMode(e){this.gameMode=e}setDifficulty(e){this.difficulty=e,this.gameState.gravitySpeed=e.getInitialGravitySpeed()}async start(){await this.gameMode.play(this.gameState,this.difficulty)}reset(){let e=this.createChamber(),t=this.createPreviewChamber();this.gameState.reset(e,t,this.difficulty.getInitialGravitySpeed())}getGameState(){return this.gameState}getGameLogic(){return this.gameLogic}getRenderer(){return this.renderer}getInputHandler(){return this.inputHandler}};var St=(o,e)=>o.y>=0&&o.y<e.length&&o.x>=0&&o.x<e[0].length,je=St;function Mt(o){let e=[];for(let t=0;t<o[0].length;t++){e.push([]);for(let r=0;r<o.length;r++)e[t].push(o[r][t])}return e}var Qe=Mt;function Ct(o){let e=Qe(o);for(let t=0;t<e.length;t++)e[t].reverse();return e}var Ye=Ct;var J=class{shapes;constructor(){this.shapes=$e()}getShapes(){return this.shapes}getShapeCoords(e){let t=[];for(let r=0;r<e.length;r++)for(let i=0;i<e[0].length;i++)e[r][i]==="O"&&t.push([r,i]);return t}deleteShape(e,t){let r=I(t);return e.forEach(i=>{r[i[0]][i[1]]="."}),r}restShape(e,t){return t.forEach(r=>{e[r[0]][r[1]]="#"}),I(e)}arraysAreEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r][0]!==t[r][0]||e[r][1]!==t[r][1])return!1;return!0}getBottomToUpFrontier(e){let t=[];for(let r=0;r<e[0].length;r++)for(let i=e.length-1;i>=0;i--)if(e[i][r]==="O"){t.push([i,r]);break}return t}canMoveDown(e){return this.getBottomToUpFrontier(e).every(r=>r[0]+1<e.length&&e[r[0]+1][r[1]]===".")}moveShapeDown=e=>{let t=this.getShapeCoords(e);if(!this.canMoveDown(e))return e;e=this.deleteShape(t,e);for(let r of t){let[i,n]=r,a=i+1,l={y:a,x:n},m=e[a][n]==="#";je(l,e)&&!m&&(e[i+1][n]="O")}return I(e)};getRightFrontier(e){let t=[];for(let r=e.length-1;r>=0;r--)for(let i=e[0].length-1;i>=0;i--)if(e[r][i]==="O"){t.push([r,i]);break}return t}canMoveRight(e){return this.getRightFrontier(e).every(r=>r[1]+1<e[0].length&&e[r[0]][r[1]+1]===".")}getLeftFrontier(e){let t=[];for(let r=0;r<e.length;r++)for(let i=0;i<e[0].length;i++)if(e[r][i]==="O"){t.push([r,i]);break}return t}collidesToTheEdges=(e,t,r)=>{let i=-1/0,n=1/0;return t.forEach(a=>{let[,l]=a;l>i&&(i=l),l<n&&(n=l)}),r===">"?i===e[0].length-1:n===0};canMoveLeft(e){return this.getLeftFrontier(e).every(r=>r[1]-1>=0&&e[r[0]][r[1]-1]===".")}moveShapeLeft(e,t){if(!this.canMoveLeft(e))return e;e=this.deleteShape(t,e);for(let r of t){let[i,n]=r,a=n-1;a>=0&&e[i][a]==="."?e[i][a]="O":e[i][n]="O"}return I(e)}moveShapeRight(e,t){if(!this.canMoveRight(e))return e;e=this.deleteShape(t,e);for(let r of t){let[i,n]=r,a=n+1;a<e[0].length&&e[i][a]==="."?e[i][a]="O":e[i][n]="O"}return I(e)}moveShapeWithGas(e,t){let r=this.getShapeCoords(e);return t==="<"?this.moveShapeLeft(e,r):t===">"?this.moveShapeRight(e,r):e}rotateShape(e){let t=this.getShapeCoords(e);if(t.length===0)return e;let r=1/0,i=-1/0,n=1/0,a=-1/0;for(let[y,f]of t)r=Math.min(r,y),i=Math.max(i,y),f!==0&&f!==16&&(n=Math.min(n,f),a=Math.max(a,f));if(n===1/0||a===-1/0)return e;let l=[];for(let y=r;y<=i;y++){let f=[];for(let C=n;C<=a;C++)f.push(e[y][C]);l.push(f)}let m=Ye(l),L=m.length,T=m[0]?.length||0,P=n+Math.floor((a-n)/2)-Math.floor((T-1)/2);P=Math.max(1,Math.min(P,17-T-1));let D=this.deleteShape(t,e),A=[];for(let y=0;y<L;y++)for(let f=0;f<T;f++)if(m[y][f]==="O"){let C=r+y,F=P+f;A.push([C,F])}if(A.every(([y,f])=>!(y<0||y>=D.length||f<0||f>=D[0].length||D[y][f]!=="."))){for(let[y,f]of A)D[y][f]="O";return D}for(let[y,f]of t)e[y][f]="O";return e}checkFilledRows(e,t){let r=0;for(let i=0;i<e.length;i++){let n=0;for(let l=0;l<e[0].length;l++)e[i][l]==="#"&&n++;if(n===t-2){r++,e.splice(i,1);let l=Array.from({length:t}).map(()=>".");e.unshift(l)}}return{numOfFilledRows:r,chamber:I(e)}}getTowerHeight(e){for(let t=0;t<e.length-1;t++)if(e[t].some(r=>r==="#"))return e.length-1-t;return 0}checkIfPlayerLost(e,t,r){return this.getTowerHeight(e)+t>=r-1}initializeChamber(){let e=Array.from({length:24}).map(()=>Array.from({length:17}).map((n,a)=>{let l=a===0,m=a===16;return l||m?"|":"."})),t=Array.from({length:17}).map(()=>"=");e.push(t);let r=Math.floor(Math.random()*this.shapes.size),i=this.shapes.get(r);return e.splice(0,i.length),e.unshift(...i),e}};var We=(o=0)=>e=>`\x1B[${e+o}m`,qe=(o=0)=>e=>`\x1B[${38+o};5;${e}m`,ze=(o=0)=>(e,t,r)=>`\x1B[${38+o};2;${e};${t};${r}m`,h={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},Br=Object.keys(h.modifier),Et=Object.keys(h.color),xt=Object.keys(h.bgColor),$r=[...Et,...xt];function Rt(){let o=new Map;for(let[e,t]of Object.entries(h)){for(let[r,i]of Object.entries(t))h[r]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},t[r]=h[r],o.set(i[0],i[1]);Object.defineProperty(h,e,{value:t,enumerable:!1})}return Object.defineProperty(h,"codes",{value:o,enumerable:!1}),h.color.close="\x1B[39m",h.bgColor.close="\x1B[49m",h.color.ansi=We(),h.color.ansi256=qe(),h.color.ansi16m=ze(),h.bgColor.ansi=We(10),h.bgColor.ansi256=qe(10),h.bgColor.ansi16m=ze(10),Object.defineProperties(h,{rgbToAnsi256:{value(e,t,r){return e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5)},enumerable:!1},hexToRgb:{value(e){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;r.length===3&&(r=[...r].map(n=>n+n).join(""));let i=Number.parseInt(r,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:e=>h.rgbToAnsi256(...h.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let t,r,i;if(e>=232)t=((e-232)*10+8)/255,r=t,i=t;else{e-=16;let l=e%36;t=Math.floor(e/36)/5,r=Math.floor(l/6)/5,i=l%6/5}let n=Math.max(t,r,i)*2;if(n===0)return 30;let a=30+(Math.round(i)<<2|Math.round(r)<<1|Math.round(t));return n===2&&(a+=60),a},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>h.ansi256ToAnsi(h.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>h.ansi256ToAnsi(h.hexToAnsi256(e)),enumerable:!1}}),h}var Tt=Rt(),S=Tt;import ue from"node:process";import Pt from"node:os";import Xe from"node:tty";function w(o,e=globalThis.Deno?globalThis.Deno.args:ue.argv){let t=o.startsWith("-")?"":o.length===1?"-":"--",r=e.indexOf(t+o),i=e.indexOf("--");return r!==-1&&(i===-1||r<i)}var{env:d}=ue,ee;w("no-color")||w("no-colors")||w("color=false")||w("color=never")?ee=0:(w("color")||w("colors")||w("color=true")||w("color=always"))&&(ee=1);function Dt(){if("FORCE_COLOR"in d)return d.FORCE_COLOR==="true"?1:d.FORCE_COLOR==="false"?0:d.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(d.FORCE_COLOR,10),3)}function At(o){return o===0?!1:{level:o,hasBasic:!0,has256:o>=2,has16m:o>=3}}function Gt(o,{streamIsTTY:e,sniffFlags:t=!0}={}){let r=Dt();r!==void 0&&(ee=r);let i=t?ee:r;if(i===0)return 0;if(t){if(w("color=16m")||w("color=full")||w("color=truecolor"))return 3;if(w("color=256"))return 2}if("TF_BUILD"in d&&"AGENT_NAME"in d)return 1;if(o&&!e&&i===void 0)return 0;let n=i||0;if(d.TERM==="dumb")return n;if(ue.platform==="win32"){let a=Pt.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in d)return["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some(a=>a in d)?3:["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some(a=>a in d)||d.CI_NAME==="codeship"?1:n;if("TEAMCITY_VERSION"in d)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(d.TEAMCITY_VERSION)?1:0;if(d.COLORTERM==="truecolor"||d.TERM==="xterm-kitty"||d.TERM==="xterm-ghostty"||d.TERM==="wezterm")return 3;if("TERM_PROGRAM"in d){let a=Number.parseInt((d.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(d.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(d.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(d.TERM)||"COLORTERM"in d?1:n}function Ke(o,e={}){let t=Gt(o,{streamIsTTY:o&&o.isTTY,...e});return At(t)}var Ot={stdout:Ke({isTTY:Xe.isatty(1)}),stderr:Ke({isTTY:Xe.isatty(2)})},Ze=Ot;function Je(o,e,t){let r=o.indexOf(e);if(r===-1)return o;let i=e.length,n=0,a="";do a+=o.slice(n,r)+e+t,n=r+i,r=o.indexOf(e,n);while(r!==-1);return a+=o.slice(n),a}function et(o,e,t,r){let i=0,n="";do{let a=o[r-1]==="\r";n+=o.slice(i,a?r-1:r)+e+(a?`\r
`:`
`)+t,i=r+1,r=o.indexOf(`
`,i)}while(r!==-1);return n+=o.slice(i),n}var{stdout:tt,stderr:rt}=Ze,me=Symbol("GENERATOR"),U=Symbol("STYLER"),Y=Symbol("IS_EMPTY"),it=["ansi","ansi","ansi256","ansi16m"],k=Object.create(null),Ft=(o,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let t=tt?tt.level:0;o.level=e.level===void 0?t:e.level};var Ht=o=>{let e=(...t)=>t.join(" ");return Ft(e,o),Object.setPrototypeOf(e,W.prototype),e};function W(o){return Ht(o)}Object.setPrototypeOf(W.prototype,Function.prototype);for(let[o,e]of Object.entries(S))k[o]={get(){let t=te(this,de(e.open,e.close,this[U]),this[Y]);return Object.defineProperty(this,o,{value:t}),t}};k.visible={get(){let o=te(this,this[U],!0);return Object.defineProperty(this,"visible",{value:o}),o}};var he=(o,e,t,...r)=>o==="rgb"?e==="ansi16m"?S[t].ansi16m(...r):e==="ansi256"?S[t].ansi256(S.rgbToAnsi256(...r)):S[t].ansi(S.rgbToAnsi(...r)):o==="hex"?he("rgb",e,t,...S.hexToRgb(...r)):S[t][o](...r),_t=["rgb","hex","ansi256"];for(let o of _t){k[o]={get(){let{level:t}=this;return function(...r){let i=de(he(o,it[t],"color",...r),S.color.close,this[U]);return te(this,i,this[Y])}}};let e="bg"+o[0].toUpperCase()+o.slice(1);k[e]={get(){let{level:t}=this;return function(...r){let i=de(he(o,it[t],"bgColor",...r),S.bgColor.close,this[U]);return te(this,i,this[Y])}}}}var Nt=Object.defineProperties(()=>{},{...k,level:{enumerable:!0,get(){return this[me].level},set(o){this[me].level=o}}}),de=(o,e,t)=>{let r,i;return t===void 0?(r=o,i=e):(r=t.openAll+o,i=e+t.closeAll),{open:o,close:e,openAll:r,closeAll:i,parent:t}},te=(o,e,t)=>{let r=(...i)=>Ut(r,i.length===1?""+i[0]:i.join(" "));return Object.setPrototypeOf(r,Nt),r[me]=o,r[U]=e,r[Y]=t,r},Ut=(o,e)=>{if(o.level<=0||!e)return o[Y]?"":e;let t=o[U];if(t===void 0)return e;let{openAll:r,closeAll:i}=t;if(e.includes("\x1B"))for(;t!==void 0;)e=Je(e,t.close,t.open),t=t.parent;let n=e.indexOf(`
`);return n!==-1&&(e=et(e,i,r,n)),r+e+i};Object.defineProperties(W.prototype,k);var kt=W(),Jr=W({level:rt?rt.level:0});var s=kt;var p=class{static moveCursorHome(){process.stdout.write("\x1B[H")}static hideCursor(){process.stdout.write("\x1B[?25l")}static showCursor(){process.stdout.write("\x1B[?25h")}static enterAltScreen(){process.stdout.write("\x1B[?1049h")}static exitAltScreen(){process.stdout.write("\x1B[?1049l")}static moveCursorUpOneLine(){process.stdout.write("\x1B[1A")}static clearLine(){process.stdout.write("\x1B[2K")}static clearPreviousLine(){this.moveCursorUpOneLine(),this.clearLine()}static moveCursorToBottom(){process.stdout.write("\x1B[999;1H")}static clearLinesUp(e){for(let t=0;t<e;t++)this.clearPreviousLine()}static clearFromCursorToEndOfScreen(){process.stdout.write("\x1B[J")}static write(e){process.stdout.write(e)}static writeLine(e){process.stdout.write(e+`
`)}static sleep(e){return new Promise(t=>setTimeout(t,e))}static colorizeCell(e){if(Number.isSafeInteger(parseInt(e)))return s.yellowBright(e);if(/[↑←↓→]/.test(e))return s.cyan(e);if(/[A-Za-z:"' ⟳]/.test(e))return s.yellowBright(e);switch(e){case"O":return s.greenBright(e);case"#":return s.white(e);case"=":return s.magentaBright(e);case"|":return s.blue(e);case".":return s.gray(e);case" ":return s.gray(e);default:return e}}static colorizeText(e){return s.yellowBright(e)}};var re=class{frameRate;constructor(e=50){this.frameRate=e}async renderFrame(e,t){let r=e.map((i,n)=>[...i,...t[n]]);p.moveCursorHome(),p.write(r.map(i=>i.map(n=>p.colorizeCell(n)).join("")).join(`
`)+`
`),await p.sleep(this.frameRate)}writeLine(e){p.writeLine(p.colorizeText(e))}enterGame(){p.enterAltScreen(),p.hideCursor()}exitGame(){p.exitAltScreen(),p.showCursor()}};var ie=class{listeners=new Map;isListening=!1;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}registerDifficultySelectionHandlers(e,t,r){this.on("difficulty-easy",e),this.on("difficulty-normal",t),this.on("difficulty-hard",r)}unregisterDifficultySelectionHandlers(e,t,r){this.off("difficulty-easy",e),this.off("difficulty-normal",t),this.off("difficulty-hard",r)}emit(e){let t=this.listeners.get(e.type);t&&t.forEach(r=>r(e))}start(){this.isListening||typeof process.stdin.setRawMode>"u"||(process.stdin.setRawMode(!0),process.stdin.resume(),process.stdin.setEncoding("utf8"),process.stdin.on("data",t=>{t===""&&(this.emit({type:"quit",timestamp:Date.now()}),process.exit()),(t==="q"||t==="Q")&&this.emit({type:"quit",timestamp:Date.now()}),t===" "&&this.emit({type:"pause",timestamp:Date.now()}),(t==="p"||t==="P")&&this.emit({type:"play",timestamp:Date.now()}),(t==="r"||t==="R")&&this.emit({type:"play-again",timestamp:Date.now()}),t==="\x1B[D"?this.emit({type:"move-left",timestamp:Date.now()}):t==="\x1B[C"?this.emit({type:"move-right",timestamp:Date.now()}):t==="\x1B[B"?this.emit({type:"move-down",timestamp:Date.now()}):t==="\x1B[A"&&this.emit({type:"rotate",timestamp:Date.now()}),t==="+"||t==="="?this.emit({type:"volume-up",timestamp:Date.now()}):(t==="-"||t==="_")&&this.emit({type:"volume-down",timestamp:Date.now()}),t==="1"?this.emit({type:"difficulty-easy",timestamp:Date.now()}):t==="2"?this.emit({type:"difficulty-normal",timestamp:Date.now()}):t==="3"&&this.emit({type:"difficulty-hard",timestamp:Date.now()})}),this.isListening=!0)}stop(){this.isListening&&(process.stdin.removeAllListeners(),process.stdin.pause())}};var V=class{getInitialGravitySpeed(){return 1100}getGravitySpeedIncrement(){return 30}getMaximumSpeed(){return 200}getLevelLinesRequired(){return 10/2}getName(){return"EASY"}},M=class{getInitialGravitySpeed(){return 850}getGravitySpeedIncrement(){return 50}getMaximumSpeed(){return 100}getLevelLinesRequired(){return 10/2}getName(){return"NORMAL"}},B=class{getInitialGravitySpeed(){return 400}getGravitySpeedIncrement(){return 80}getMaximumSpeed(){return 100/2}getLevelLinesRequired(){return 10}getName(){return"HARD"}};import{spawn as Vt}from"child_process";import{resolve as ot}from"path";import{existsSync as Bt}from"fs";function q(o,e){let t=0;return()=>{let r=Date.now();return r-t>=e?(t=r,o(),!0):!1}}function oe(o){let e=ot(process.cwd(),"dist/sounds",o),t=ot(process.cwd(),"src/audio/sounds",o);return Bt(e)?e:t}var $t={move:{path:oe("move.wav"),defaultVolume:.5},lineComplete:{path:oe("line-complete.wav"),defaultVolume:.7},gameLoss:{path:oe("game-loss.wav"),defaultVolume:.8},blockRest:{path:oe("block-rest.wav"),defaultVolume:.6}},ne=class{volume=.5;playMove=q(()=>this.playSound("move"),100);playLineComplete=q(()=>this.playSound("lineComplete"),100);playGameLoss=q(()=>this.playSound("gameLoss"),100);playBlockRest=q(()=>this.playSound("blockRest"),50);setVolume(e){this.volume=Math.max(0,Math.min(1,e))}getVolume(){return this.volume}increaseVolume(){this.setVolume(this.volume+.1)}decreaseVolume(){this.setVolume(this.volume-.1)}play(e){switch(e){case"move":this.playMove();break;case"lineComplete":this.playLineComplete();break;case"gameLoss":this.playGameLoss();break;case"blockRest":this.playBlockRest();break}}playSound(e){let t=$t[e];if(!t)return;let r=process.platform,i,n;if(r==="darwin")i="afplay",n=[t.path];else if(r==="win32")i="powershell",n=["-c","Add-Type -AssemblyName System.Media; [System.Media.SystemSounds]::Beep.Play()"];else{let a=Math.round(this.volume*65536);i="paplay",n=[`--volume=${a}`,t.path]}Vt(i,n,{stdio:"ignore",detached:!0}).unref()}};import{spawn as be,execSync as Le}from"child_process";import{resolve as nt}from"path";import{existsSync as jt}from"fs";var we=(()=>{let o=nt(process.cwd(),"dist/sounds","background-music.wav"),e=nt(process.cwd(),"src/audio/sounds","background-music.wav");return jt(o)?o:e})(),se=class o{static instance=null;process=null;paplayPid=null;isPlaying=!1;volume=.5;constructor(){process.on("exit",()=>this.stop()),process.on("SIGINT",()=>{this.stop(),process.exit(0)}),process.on("SIGTERM",()=>{this.stop(),process.exit(0)})}static getInstance(){return o.instance||(o.instance=new o),o.instance}play(){this.isPlaying||(this.isPlaying=!0,this.startMusic())}stop(){if(this.isPlaying){if(this.isPlaying=!1,this.paplayPid){try{process.platform==="win32"?Le(`taskkill /PID ${this.paplayPid} /F`,{stdio:"ignore"}):Le(`kill -9 ${this.paplayPid}`,{stdio:"ignore"})}catch{}this.paplayPid=null}this.process=null}}setVolume(e){let t=Math.max(0,Math.min(1,e));if(t!==this.volume&&(this.volume=t,this.isPlaying&&this.paplayPid&&process.platform==="linux"))try{let r=Math.round(t*100);Le(`pactl set-sink-volume @DEFAULT_SINK@ ${r}%`,{stdio:"ignore"})}catch{}}getVolume(){return this.volume}increaseVolume(){this.setVolume(this.volume+.1)}decreaseVolume(){this.setVolume(this.volume-.1)}startMusic(){let e=process.platform;if(e==="darwin"){let t="bash",r=["-c",`while true; do afplay "${we}" 2>/dev/null || break; done`];this.process=be(t,r,{stdio:"ignore",detached:!0}),this.process.pid&&(this.paplayPid=this.process.pid,this.process.unref())}else if(e==="win32"){let t="powershell",r=["-c",`while ($true) { & "${we}" 2>$null; if ($LASTEXITCODE -ne 0) { break } }`];this.process=be(t,r,{stdio:"ignore",detached:!0}),this.process.pid&&(this.paplayPid=this.process.pid,this.process.unref())}else this.spawnPaplayLoop()}spawnPaplayLoop(){if(!this.isPlaying)return;let e=be("paplay",[we],{stdio:"ignore",detached:!1});e.pid&&(this.paplayPid=e.pid),e.on("close",()=>{this.isPlaying&&setTimeout(()=>{this.spawnPaplayLoop()},100)}),e.on("error",()=>{this.isPlaying&&setTimeout(()=>{this.spawnPaplayLoop()},100)})}};var $=class{constructor(e){this.inputHandler=e}listeners=[];isActive=!1;registerListener(e,t){this.inputHandler.on(e,t),this.listeners.push({eventType:e,handler:t})}activate(){this.isActive=!0}cleanup(){for(let e of this.listeners)this.inputHandler.off(e.eventType,e.handler);this.listeners=[],this.isActive=!1}isRunning(){return this.isActive}getListenerCount(){return this.listeners.length}};var G=class{gameLogic;renderer;inputHandler;mediator;demoSequence=null;demoMoveIndex=0;onRenderCallback=null;rotateListener=null;isInDemoMode=!1;soundManager;backgroundMusic;selectedDifficulty=null;isShowingDifficultyMenu=!1;lastMenuTime=0;modeLifecycle;constructor(e,t,r,i,n,a){this.gameLogic=e,this.renderer=t,this.inputHandler=r,this.mediator=i,this.demoSequence=n||null,this.isInDemoMode=n?n.length>0:!1,this.onRenderCallback=a||null,this.soundManager=new ne,this.backgroundMusic=se.getInstance()}getNewShapeIdx(){return Math.floor(Math.random()*this.gameLogic.getShapes().size)}resetGameLoopState(e,t,r){e.reset(this.gameLogic.initializeChamber(),R.initializeChamber(),t.getInitialGravitySpeed()),r.keyQueue.length=0,r.lastGravityTime=Date.now(),r.hasRested=!1,r.newShapeIdx=this.getNewShapeIdx(),r.gameOverHandled=!1,r.needsRender=!1,this.demoMoveIndex=0,this.selectedDifficulty=null,e.previewChamber=R.addPreviewNextShape(r.newShapeIdx,e.previewChamber,e.level,e.score,t),e.isActive=!0}clearFooter(){p.clearPreviousLine(),p.clearPreviousLine(),p.clearPreviousLine()}increaseVolume(){this.soundManager.increaseVolume(),this.backgroundMusic.increaseVolume()}decreaseVolume(){this.soundManager.decreaseVolume(),this.backgroundMusic.decreaseVolume()}registerMovementHandlers(e,t){let i=()=>{e.isActive&&t.keyQueue.length<2e3&&(t.keyQueue.push("<"),this.beep())},n=()=>{e.isActive&&t.keyQueue.length<2e3&&(t.keyQueue.push(">"),this.beep())},a=()=>{e.isActive&&t.keyQueue.length<2e3&&(t.keyQueue.push("down"),this.beep())};this.inputHandler.on("move-left",i),this.inputHandler.on("move-right",n),this.inputHandler.on("move-down",a)}beep(){this.soundManager.play("move")}playLineComplete(){this.soundManager.play("lineComplete")}playGameLoss(){this.soundManager.play("gameLoss")}registerPlayListener(e,t,r){this.modeLifecycle.registerListener("play",()=>{if(e.isActive)return;let i=Date.now();i-this.lastMenuTime<500||(this.lastMenuTime=i,!this.isShowingDifficultyMenu&&this.selectedDifficulty===null&&(this.isShowingDifficultyMenu=!0,this.showDifficultyMenuSync().then(n=>{this.selectedDifficulty=n,t=n,this.resetGameLoopState(e,t,r),this.registerMovementHandlers(e,r),this.clearFooter()}).catch(n=>{console.error("DEBUG: Error in difficulty selection:",n)}).finally(()=>{this.isShowingDifficultyMenu=!1})))})}registerPauseListener(e,t){this.modeLifecycle.registerListener("pause",()=>{e.isActive&&(e.isPaused=!e.isPaused,e.isPaused?p.write(p.colorizeText(`GAME PAUSED - Press 'space' to resume
`)):(p.clearPreviousLine(),t.needsRender=!0))})}registerPlayAgainListener(e,t,r){this.modeLifecycle.registerListener("play-again",()=>{if(!e.isActive){let i=Date.now();if(i-this.lastMenuTime<500)return;this.lastMenuTime=i,this.showDifficultyMenuSync().then(n=>{t=n,this.resetGameLoopState(e,t,r)}).catch(n=>{console.error("DEBUG: Error in difficulty selection (play-again):",n)})}})}registerRotateListener(e,t){this.rotateListener&&this.inputHandler.off("rotate",this.rotateListener),this.rotateListener=()=>{e.isActive&&t.keyQueue.length<2e3&&!this.isInDemoMode&&(t.keyQueue.push("rotate"),this.beep())},this.modeLifecycle.registerListener("rotate",this.rotateListener)}registerQuitListener(e){this.modeLifecycle.registerListener("quit",()=>{e.isActive=!1,this.backgroundMusic.stop(),this.renderer.exitGame(),process.exit(0)})}registerVolumeListeners(){this.modeLifecycle.registerListener("volume-up",()=>{this.increaseVolume()}),this.modeLifecycle.registerListener("volume-down",()=>{this.decreaseVolume()})}showDifficultyMenuSync(){return p.write(p.colorizeText(`

SELECT DIFFICULTY:

1 - Easy
2 - Normal (default)
3 - Hard

Selection will default to Normal in 15 seconds...

`)),new Promise(e=>{let t=null,r=()=>{t&&clearTimeout(t);for(let a=0;a<12;a++)p.clearPreviousLine();this.inputHandler.unregisterDifficultySelectionHandlers(r,i,n),e(new V)},i=()=>{t&&clearTimeout(t);for(let a=0;a<12;a++)p.clearPreviousLine();this.inputHandler.unregisterDifficultySelectionHandlers(r,i,n),e(new M)},n=()=>{t&&clearTimeout(t);for(let a=0;a<12;a++)p.clearPreviousLine();this.inputHandler.unregisterDifficultySelectionHandlers(r,i,n),e(new B)};this.inputHandler.registerDifficultySelectionHandlers(r,i,n),t=setTimeout(()=>{for(let a=0;a<12;a++)p.clearPreviousLine();this.inputHandler.unregisterDifficultySelectionHandlers(r,i,n),e(new M)},15e3)})}async play(e,t){let r=this.mediator;this.modeLifecycle=new $(this.inputHandler),this.modeLifecycle.activate();let i={keyQueue:[],lastGravityTime:Date.now(),hasRested:!1,newShapeIdx:this.getNewShapeIdx(),gameOverHandled:!1,needsRender:!1},n=2e3,a=this.gameLogic.getShapes();this.isInDemoMode||this.resetGameLoopState(e,t,i),this.demoSequence?.length||this.registerMovementHandlers(e,i),this.registerPlayAgainListener(e,t,i),this.isInDemoMode||(this.registerPlayListener(e,t,i),this.registerPauseListener(e,i)),this.registerRotateListener(e,i),this.registerQuitListener(e),this.registerVolumeListeners(),this.inputHandler.start(),this.renderer.enterGame(),this.backgroundMusic.play(),e.previewChamber=R.addPreviewNextShape(i.newShapeIdx,e.previewChamber,e.level,e.score,t);try{for(;!(this.isInDemoMode&&r.getCurrentPhase()==="playing");){if(!e.isActive&&!i.gameOverHandled){if(i.gameOverHandled=!0,this.demoSequence){this.resetGameLoopState(e,t,i);continue}for(p.write(p.colorizeText(`
YOU LOST!! Press 'r' to play again or 'q' to exit
`));!e.isActive;)await p.sleep(100);p.clearPreviousLine(),p.clearPreviousLine();continue}if(e.isPaused){await p.sleep(50);continue}if(this.demoSequence){let m=this.demoSequence[this.demoMoveIndex%this.demoSequence.length];i.keyQueue.length<n&&i.keyQueue.push(m),this.demoMoveIndex++,await p.sleep(650)}for(;i.keyQueue.length>0;){let m=i.keyQueue.shift();m==="rotate"?e.chamber=this.gameLogic.rotateShape(e.chamber):m==="<"||m===">"?e.chamber=this.gameLogic.moveShapeWithGas(e.chamber,m):m==="down"&&(e.chamber=this.gameLogic.moveShapeDown(e.chamber))}let l=Date.now();if(l-i.lastGravityTime>e.gravitySpeed){i.lastGravityTime=l;let m=this.gameLogic.getShapeCoords(e.chamber);e.chamber=this.gameLogic.moveShapeDown(e.chamber);let L=this.gameLogic.getShapeCoords(e.chamber);if(this.gameLogic.arraysAreEqual(m,L)){e.chamber=this.gameLogic.restShape(e.chamber,L),e.isActive&&!this.isInDemoMode&&this.soundManager.play("blockRest");let T=a.get(i.newShapeIdx);e.chamber.splice(0,T.length),e.chamber.unshift(...T),i.lastGravityTime=Date.now(),i.keyQueue.length=0;let{numOfFilledRows:O,chamber:P}=this.gameLogic.checkFilledRows(e.chamber,17);if(e.chamber=P,e.totalFilledRows+=O,e.score+=O,O&&this.playLineComplete(),e.totalFilledRows>=t.getLevelLinesRequired()&&(e.gravitySpeed=Math.max(t.getMaximumSpeed(),e.gravitySpeed-t.getGravitySpeedIncrement()),e.totalFilledRows=e.totalFilledRows%t.getLevelLinesRequired(),e.level++),i.hasRested=!0,this.gameLogic.checkIfPlayerLost(e.chamber,a.get(i.newShapeIdx).length,25)){this.playGameLoss(),e.isActive=!1;continue}i.newShapeIdx=this.getNewShapeIdx()}}i.hasRested&&(e.previewChamber=R.addPreviewNextShape(i.newShapeIdx,e.previewChamber,e.level,e.score,t),i.hasRested=!1),(i.needsRender||!e.isPaused)&&(await this.renderer.renderFrame(e.chamber,e.previewChamber),i.needsRender=!1),this.onRenderCallback&&this.demoSequence&&r.getCurrentPhase()==="demo"&&this.onRenderCallback()}}finally{this.modeLifecycle.cleanup()}}};import Qt from"node:fs/promises";var Yt=async(o,e="array",t="")=>{let r="";try{r=await Qt.readFile(o,"utf-8")}catch(i){if(console.error("Error reading file:",i),i instanceof Error)throw new Error(i.message)}return r.length===0?[]:e==="array"?r.trim().split(`
`):e==="2d"?r.trim().split(`
`).map(i=>i.split(t)):r},st=Yt;import Wt from"path";async function Se(){try{let o=Wt.resolve(process.cwd(),"inputSample.txt"),e=await st(o,"string"),t=[];for(let r of e)switch(r){case"<":t.push("<");break;case">":t.push(">");break;case"r":t.push("rotate");break;case"d":t.push("down");break}return t}catch(o){return console.error("Failed to read movements from inputSample.txt, using defaults",o),["<",">","rotate","<",">","rotate","down"]}}var at={contentWidth:45,padding:"    "},qt=[{type:"content",leading:0,text:s.cyan(" ### ")+"  "+s.gray("###")+"   "+s.green("###")+"    "+s.magenta("#")+"    "+s.red("#")},{type:"content",leading:0,text:s.cyan("#   #")+"  "+s.gray("#")+"    "+s.green("#   #")+"   "+s.magenta("#")+"    "+s.red("#")},{type:"content",leading:0,text:s.cyan("#####")+"  "+s.gray("##")+"   "+s.green("#")+"       "+s.magenta("#")+"    "+s.red("#")},{type:"content",leading:0,text:s.cyan("#   #")+"  "+s.gray("  #")+"  "+s.green("#   #")+"   "+s.magenta("#")+"    "+s.red("#")},{type:"content",leading:0,text:s.cyan("#   #")+"  "+s.gray("###")+"   "+s.green("###")+"    "+s.magenta("#")+"    "+s.red("#")}],zt=[{type:"content",leading:0,text:s.cyan("###")+"  "+s.yellow("####")+"  "+s.green("###")+"  "+s.magenta("###")+"  "+s.red("####")+"  "+s.blue("#")+"  "+s.yellow("###")+"  "+s.gray("###")},{type:"content",leading:0,text:s.cyan(" #")+"   "+s.yellow("#")+"     "+s.green(" #")+"   "+s.magenta("# #")+"  "+s.red("#  #")+"  "+s.blue("#")+"  "+s.yellow("#  #")+" "+s.gray("#")},{type:"content",leading:0,text:s.cyan(" #")+"   "+s.yellow("###")+"   "+s.green(" #")+"   "+s.magenta("##")+"   "+s.red("#  #")+"  "+s.blue("#")+"  "+s.yellow("#  #")+" "+s.gray("##")},{type:"content",leading:0,text:s.cyan(" #")+"   "+s.yellow("#")+"     "+s.green(" #")+"   "+s.magenta("# #")+"  "+s.red("#  #")+"  "+s.blue("#")+"  "+s.yellow("#  #")+"  "+s.gray(" #")},{type:"content",leading:0,text:s.cyan(" #")+"   "+s.yellow("####")+"  "+s.green(" #")+"   "+s.magenta("#  #")+" "+s.red("####")+"  "+s.blue("#")+"  "+s.yellow("###")+"  "+s.gray("###")}],lt=[{type:"top"},{type:"empty"},...qt,{type:"empty"},...zt,{type:"empty"},{type:"divider"},{type:"empty"},{type:"content",leading:0,text:s.cyan("Rules:")+s.gray(" Stack falling blocks")},{type:"content",leading:0,text:s.cyan("Arrow Keys:")+s.gray(" Move & Rotate")},{type:"content",leading:0,text:s.cyan("+/-:")+s.gray(" Volume  |  Space: Pause  |  Q: Quit")},{type:"empty"},{type:"divider"},{type:"empty"},{type:"content",leading:0,text:s.gray("Author: ")+s.gray("Myron Apostolakis (2026)")},{type:"empty"},{type:"content",leading:0,text:s.cyan("https://github.com/myapos/ascii-tetroids")},{type:"empty"},{type:"bottom"}];var ct={contentWidth:39,padding:""},Me=[{type:"top"},{type:"content",leading:0,text:" "+s.green("Press P to Play")+s.gray("  (Q to Quit)")},{type:"bottom"}];var ae=class{gameLogic;renderer;inputHandler;mediator;classicMode;modeLifecycle;playListener=null;menuActive=!1;constructor(e,t,r,i){this.gameLogic=e,this.renderer=t,this.inputHandler=r,this.mediator=i}async initialize(){let e=await Se();this.classicMode=new G(this.gameLogic,this.renderer,this.inputHandler,this.mediator,e,()=>this.displayDemoFooter())}async play(e,t){let r=this.mediator;this.modeLifecycle=new $(this.inputHandler),this.modeLifecycle.activate(),await this.initialize(),this.displaySplashScreen(),r.setPhase("splash");let{userInitiatedPlay:i,selectedDifficulty:n}=await this.waitForPlayOrTimeout(t);r.setUserInitiated(i);let a=n||t;try{let l=new G(this.gameLogic,this.renderer,this.inputHandler,this.mediator,i?void 0:await Se(),i?void 0:()=>this.displayDemoFooter());i?r.setPhase("playing"):r.setPhase("demo"),await l.play(e,a),r.getCurrentPhase()==="playing"&&!i&&(a=r.getSelectedDifficulty()||t,this.modeLifecycle.cleanup(),await new G(this.gameLogic,this.renderer,this.inputHandler,this.mediator).play(e,a))}finally{this.modeLifecycle.cleanup(),r.reset()}}async waitForPlayOrTimeout(e){let t=this.mediator;return new Promise(r=>{let i=!1;this.playListener=async()=>{if(t.getCurrentPhase()==="demo"){let a=await this.showDifficultyMenu();t.setSelectedDifficulty(a),t.setPhase("playing");return}i=!0;let n=await this.showDifficultyMenu();r({userInitiatedPlay:!0,selectedDifficulty:n})},this.modeLifecycle.registerListener("play",this.playListener),this.inputHandler.start(),setTimeout(()=>{i||(t.setPhase("demo"),r({userInitiatedPlay:!1,selectedDifficulty:e}))},1e3)})}displaySplashScreen(){p.moveCursorHome(),console.clear();let e=lt.map(t=>this.formatLine(t,at)).join(`
`);console.log(e)}async showDifficultyMenu(){if(this.menuActive)return new M;this.menuActive=!0;let e=p.colorizeText(`

SELECT DIFFICULTY:

1 - Easy
2 - Normal (default)
3 - Hard

Selection will default to Normal in 15 seconds...

`);return p.write(e),new Promise(t=>{let r=null,i=()=>{this.menuActive=!1,this.inputHandler.unregisterDifficultySelectionHandlers(n,a,l)},n=()=>{r&&clearTimeout(r),console.clear(),p.moveCursorHome(),p.clearFromCursorToEndOfScreen(),i(),t(new V)},a=()=>{r&&clearTimeout(r),console.clear(),p.moveCursorHome(),p.clearFromCursorToEndOfScreen(),i(),t(new M)},l=()=>{r&&clearTimeout(r),console.clear(),p.moveCursorHome(),p.clearFromCursorToEndOfScreen(),i(),t(new B)};this.inputHandler.registerDifficultySelectionHandlers(n,a,l),r=setTimeout(()=>{console.clear(),p.moveCursorHome(),p.clearFromCursorToEndOfScreen(),i(),t(new M)},15e3)})}formatLine(e,t){let{contentWidth:r,borderLeft:i=s.cyan("\u2551"),borderRight:n=s.cyan("\u2551"),padding:a}=t;switch(e.type){case"top":return`${a}${s.cyan("\u2554")}${s.cyan("\u2550".repeat(r))}${s.cyan("\u2557")}`;case"divider":return`${a}${s.cyan("\u2560")}${s.cyan("\u2550".repeat(r))}${s.cyan("\u2563")}`;case"bottom":return`${a}${s.cyan("\u255A")}${s.cyan("\u2550".repeat(r))}${s.cyan("\u255D")}`;case"empty":return`${a}${i}${" ".repeat(r)}${n}`;case"content":{let l=" ".repeat(e.leading||0),m=this.stripAnsi(e.text||""),L=Math.max(0,r-e.leading-m.length);return`${a}${i}${l}${e.text}${" ".repeat(L)}${n}`}default:return""}}stripAnsi(e){let t=new RegExp("\x1B\\[[0-9;]*m","g");return e.replace(t,"")}displayDemoFooter(){let e=Me.map(t=>this.formatLine(t,ct)).join(`
`);console.log(e)}clearDemoFooter(){let e=Me.length+1;for(let t=0;t<e;t++)p.clearPreviousLine()}isUserInitiated(){return this.mediator.isUserInitiated()}resetUserInitiatedFlag(){this.mediator.setUserInitiated(!1)}};var Ee=class{currentPhase="splash";selectedDifficulty=null;isUserInitiatedGame=!1;eventListeners=new Map;getCurrentPhase(){return this.currentPhase}setPhase(e){this.currentPhase=e}isInPhase(e){return this.currentPhase===e}getSelectedDifficulty(){return this.selectedDifficulty}setSelectedDifficulty(e){this.selectedDifficulty=e,this.emit({type:"difficulty-selected",payload:e})}isUserInitiated(){return this.isUserInitiatedGame}setUserInitiated(e){this.isUserInitiatedGame=e}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}off(e,t){this.eventListeners.get(e)?.delete(t)}emit(e){let t=this.eventListeners.get(e.type);t&&t.forEach(r=>r(e))}reset(){this.currentPhase="splash",this.selectedDifficulty=null,this.isUserInitiatedGame=!1}},Ce=null;function pt(){return Ce||(Ce=new Ee),Ce}var xe=class{async run(){let e=new J,t=new re,r=new ie,i=new M,n=pt(),a=new Z(e,t,r,i),l=new ae(e,t,r,n),m=new G(e,t,r,n),L=!0;for(;;)a.setDifficulty(i),L?a.setGameMode(l):a.setGameMode(m),await a.start(),L&&l.isUserInitiated()?(L=!1,l.resetUserInitiatedFlag()):(a.reset(),L=!0,l.resetUserInitiatedFlag())}},ut=async()=>{await new xe().run()};async function Kt(){await ut()}Kt().catch(console.error);
